.row
	.large-12.columns
		%ul.breadcrumbs
			%li= link_to 'apps', admin_apps_path
			%li= link_to @app.name, admin_app_path(@app)
			%li= link_to 'entities', admin_app_end_entities_path(@app)
			%li.current= @end_entity.did

.row
	.large-6.columns
		UUID
	.large-6.columns
		= @end_entity.uuid
	
.row
	.large-6.columns
		Identifier
	.large-6.columns
		= @end_entity.did
		
.row
	.large-6.columns
		Status
	.large-6.columns
		- if @end_entity.status == 0
			New
		- elsif @end_entity.status == 1
			Pending
		- elsif @end_entity.status == 2
			Generated

- if @end_entity.status == 2

	.row
		.large-6.columns

			- if @certificates and @certificates.select{ |certificate| certificate.status == 'V' }.length > 0

				= link_to 'renew', admin_app_end_entity_renew_path(@app, @end_entity), method: :post, class: 'button tiny'
				
			#rekey-button.button.tiny
				rekey

		.large-6.columns

.row
	.large-12.columns
		
		#rekey-form.hidden
		
			= form_tag admin_app_end_entity_rekey_path(@app, @end_entity) do 
			
				.row
					.large-6.columns
						%label.inline
							CSR
					.large-6.columns
						= text_area_tag 'csr'
				.row
					.large-6.columns
					.large-6.columns
						= submit_tag 'generate', class: 'button tiny'
						#rekey-cancel-button.button.tiny
							cancel
					

- if @certificates and @certificates.length > 0
	
	.row
		.large-12.columns
			
			- @certificates.each do | certificate |
				
				.row
					.large-6.columns
			
						- cert = OpenSSL::X509::Certificate.new(certificate.certificate)
						= cert.serial.to_s(16)
						= "Current cert expires in #{ days_left(cert.not_after) }"
						
					.large-2.columns
					
						- if certificate.status == 'V'
							
							- if Time.now.to_i >= cert.not_before.to_i and Time.now.to_i <= cert.not_after.to_i
							
								( Valid )
							
							- else
							
								- if Time.now.to_i > cert.not_before.to_i
							
									( Expired )
									
								- else
								
									( Not Valid )
							
						- else
						
							( Revoked )

					.large-4.columns
						
						.right
						
							- if certificate.status == 'V'

								= link_to 'pem', admin_app_end_entity_cert_pem_path(@app, @end_entity), class: 'button tiny'
								= link_to 'der', admin_app_end_entity_cert_der_path(@app, @end_entity), class: 'button tiny'
								= link_to 'revoke', admin_app_end_entity_certificate_revoke_path(@app, @end_entity, certificate), method: :post, data: {confirm: "Revoke certificate (#{cert.serial.to_s(16)})?"}, class: 'button tiny'
						
							- else
						
								= certificate.revoked_at.strftime("%d/%m/%Y %H:%M:%S")

	
- else	

	= form_tag admin_app_end_entity_enrol_path(@app, @end_entity) do 
		.row
			.large-6.columns
				%label.inline
					CSR
			.large-6.columns
				= text_area_tag 'csr'
		.row
			.large-6.columns
			.large-6.columns
				= submit_tag 'generate', class: 'button tiny'

	
= link_to 'back to end entities', admin_app_end_entities_path(@app), class: 'button tiny'